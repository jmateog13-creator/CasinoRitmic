<!DOCTYPE html>
<html lang="ca">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qui Vol Ser Milionari R√≠tmic</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Copperplate&display=swap');

        :root {
            --blue-bg: #0a0a2a;
            --blue-light: #1e3c72;
            --gold: #ffd700;
            --orange: #ff8c00;
        }

        body {
            margin: 0;
            padding: 0;
            background: radial-gradient(circle, var(--blue-light), var(--blue-bg));
            font-family: 'Copperplate', serif;
            overflow: hidden;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            color: white;
            user-select: none;
        }

        /* UI Bar */
        #ui-bar {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-sizing: border-box;
            z-index: 100;
            background: rgba(0, 0, 0, 0.5);
        }

        .btn-menu {
            text-decoration: none;
            color: var(--gold);
            font-size: 1.2rem;
            border: 1px solid var(--gold);
            padding: 5px 15px;
            border-radius: 5px;
        }

        /* Game Area */
        #game-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            width: 100%;
            max-width: 1000px;
        }

        /* Logo Area */
        #logo-area {
            margin-bottom: 20px;
            text-align: center;
        }

        #logo-area h1 {
            font-size: 3rem;
            color: var(--gold);
            text-shadow: 0 0 20px var(--gold);
            margin: 0;
        }

        /* Question Box */
        #question-box {
            width: 80%;
            background: black;
            border: 2px solid white;
            border-radius: 20px;
            padding: 20px;
            text-align: center;
            font-size: 1.5rem;
            margin-bottom: 20px;
            position: relative;
        }

        #question-box::before,
        #question-box::after {
            content: "";
            position: absolute;
            top: 50%;
            width: 50px;
            height: 2px;
            background: white;
        }

        #question-box::before {
            left: -50px;
        }

        #question-box::after {
            right: -50px;
        }

        /* Answers Grid */
        #answers-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            width: 90%;
        }

        .answer-btn {
            background: black;
            border: 2px solid white;
            border-radius: 30px;
            padding: 15px;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            text-align: left;
            position: relative;
            transition: background 0.2s;
            font-family: 'Copperplate', serif;
        }

        .answer-btn:hover {
            background: var(--orange);
            color: black;
        }

        .answer-btn.correct {
            background: #0f0;
            color: black;
            animation: blink 0.5s 3;
        }

        .answer-btn.wrong {
            background: #f00;
            color: white;
        }

        @keyframes blink {
            0% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }

            100% {
                opacity: 1;
            }
        }

        /* Lifelines */
        #lifelines {
            display: flex;
            gap: 20px;
            margin-top: 30px;
        }

        .lifeline {
            width: 60px;
            height: 40px;
            border: 2px solid var(--gold);
            border-radius: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            font-weight: bold;
            color: var(--gold);
        }

        .lifeline.used {
            opacity: 0.3;
            cursor: default;
            border-color: #555;
            color: #555;
        }

        /* Ladder (Side) */
        #ladder {
            position: absolute;
            right: 20px;
            top: 100px;
            display: flex;
            flex-direction: column-reverse;
            gap: 5px;
            font-size: 0.9rem;
            color: var(--orange);
        }

        .ladder-step {
            padding: 2px 10px;
        }

        .ladder-step.active {
            background: var(--orange);
            color: black;
            border-radius: 10px;
        }

        .ladder-step.safe {
            color: white;
        }

        /* Modals */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: #0a0a2a;
            padding: 40px;
            border: 4px double var(--gold);
            text-align: center;
            max-width: 600px;
            color: white;
            position: relative;
        }

        .close-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            color: #aaa;
            font-size: 2rem;
            cursor: pointer;
        }

        .relic-icon {
            font-size: 5rem;
            margin: 20px;
        }

        .action-btn {
            padding: 10px 30px;
            font-size: 1.2rem;
            background: var(--gold);
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            color: black;
            margin-top: 20px;
        }

        /* Instructions Modal specific */
        #instructions-modal .instr-btn {
            padding: 10px 30px;
            font-size: 1.2rem;
            background: var(--gold);
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            color: black;
            margin-top: 20px;
        }
    </style>
</head>

<body>

    <div id="ui-bar">
        <div style="display:flex; align-items:center; gap:10px; color:var(--gold);">
            <span>üîä</span>
            <input type="range" id="volume" min="0" max="1" step="0.1" value="0.5" style="accent-color: var(--gold);">
        </div>
        <a href="menu.html" class="btn-menu">üè† MEN√ö</a>
    </div>

    <div id="ladder">
        <!-- Injected -->
    </div>

    <div id="game-area">
        <div id="logo-area">
            <h1>QUI VOL SER MILIONARI?</h1>
            <h2 style="font-size:1.5rem; color:white;">EDICI√ì R√çTMICA</h2>
        </div>

        <div id="question-box">
            <!-- Question -->
        </div>

        <div id="answers-grid">
            <button class="answer-btn" id="btn-0" onclick="game.answer(0)">A:</button>
            <button class="answer-btn" id="btn-1" onclick="game.answer(1)">B:</button>
            <button class="answer-btn" id="btn-2" onclick="game.answer(2)">C:</button>
            <button class="answer-btn" id="btn-3" onclick="game.answer(3)">D:</button>
        </div>

        <div id="lifelines">
            <div class="lifeline" id="life-50" onclick="game.use5050()">50:50</div>
            <div class="lifeline" id="life-phone" onclick="game.usePhone()">üìû</div>
            <div class="lifeline" id="life-public" onclick="game.usePublic()">üë•</div>
        </div>
    </div>

    <!-- Instructions Modal -->
    <div id="instructions-modal" class="modal" style="display:flex;">
        <div class="modal-content">
            <span class="close-btn"
                onclick="document.getElementById('instructions-modal').style.display='none'">√ó</span>
            <h2 style="color: var(--gold);">COM JUGAR</h2>
            <p>1. Respon 15 preguntes sobre ritme i m√∫sica.</p>
            <p>2. Utilitza els comodins si et quedes encallat.</p>
            <p>3. Arriba al mili√≥ per guanyar la Rel√≠quia!</p>
            <button class="instr-btn" onclick="game.start()">JUGAR</button>
        </div>
    </div>

    <!-- Epic Reward Modal -->
    <div id="epic-modal" class="modal">
        <div class="modal-content">
            <h2 style="color: var(--gold);">EL PODER ABSOLUT!</h2>
            <div class="relic-icon">ü™Ñ</div>
            <h3 style="color: var(--gold);">LA BATUTA D'OR DE KARAJAN</h3>
            <p style="font-style: italic; color: #aaa;">"La batuta del llegendari Herbert von Karajan. S√≠mbol de
                l'autoritat suprema i el control total sobre l'orquestra."</p>
            <button class="action-btn" onclick="location.reload()">TORNAR AL MEN√ö</button>
        </div>
    </div>

    <!-- Lose Modal -->
    <div id="lose-modal" class="modal">
        <div class="modal-content">
            <h2 style="color: red;">INCORRECTE!</h2>
            <p>Has perdut. Torna-ho a intentar.</p>
            <button class="action-btn" onclick="location.reload()">REINICIAR</button>
        </div>
    </div>

    <!-- Phone Modal -->
    <div id="phone-modal" class="modal">
        <div class="modal-content">
            <h2 style="color: var(--gold);">TRUCADA A UN COMPOSITOR</h2>
            <p id="phone-msg">...</p>
            <button class="action-btn"
                onclick="document.getElementById('phone-modal').style.display='none'">GR√ÄCIES</button>
        </div>
    </div>

    <audio id="bg-music" src="music/background_music_main.mp3" loop></audio>

    <script>
        // --- AUDIO ---
        const bgMusic = document.getElementById('bg-music');
        document.body.addEventListener('click', () => {
            if (bgMusic.paused) {
                bgMusic.volume = document.getElementById('volume').value * 0.5;
                bgMusic.play().catch(e => console.log(e));
            }
        }, { once: true });

        document.getElementById('volume').addEventListener('input', (e) => {
            bgMusic.volume = e.target.value * 0.5;
        });

        const AudioContext = window.AudioContext || window.webkitAudioContext;
        const audioCtx = new AudioContext();

        function playSound(type) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const vol = parseFloat(document.getElementById('volume').value);
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            const now = audioCtx.currentTime;

            if (type === 'select') {
                osc.type = 'sine';
                osc.frequency.setValueAtTime(600, now);
                gain.gain.setValueAtTime(vol * 0.2, now);
                gain.gain.linearRampToValueAtTime(0, now + 0.1);
                osc.start();
                osc.stop(now + 0.1);
            } else if (type === 'correct') {
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(440, now);
                osc.frequency.setValueAtTime(880, now + 0.2);
                osc.frequency.setValueAtTime(1320, now + 0.4);
                gain.gain.setValueAtTime(vol * 0.3, now);
                gain.gain.linearRampToValueAtTime(0, now + 1);
                osc.start();
                osc.stop(now + 1);
            } else if (type === 'wrong') {
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(100, now);
                osc.frequency.linearRampToValueAtTime(50, now + 0.5);
                gain.gain.setValueAtTime(vol * 0.3, now);
                gain.gain.linearRampToValueAtTime(0, now + 0.5);
                osc.start();
                osc.stop(now + 0.5);
            }
        }

        // --- DATA ---
        const QUESTIONS = [
            { q: "Quina nota val 4 temps?", a: ["Rodona", "Blanca", "Negra", "Corxera"], c: 0 },
            { q: "Quantes negres caben en una rodona?", a: ["2", "3", "4", "8"], c: 2 },
            { q: "Quin valor t√© una Blanca?", a: ["1", "2", "3", "4"], c: 1 },
            { q: "Qu√® significa 'Allegro'?", a: ["Lent", "R√†pid", "Trist", "Fort"], c: 1 },
            { q: "Quin √©s el silenci de 1 temps?", a: ["Silenci de Blanca", "Silenci de Negra", "Silenci de Rodona", "Silenci de Corxera"], c: 1 },
            { q: "Quantes corxeres fan una blanca?", a: ["2", "4", "6", "8"], c: 1 },
            { q: "Qui va compondre la 9a Simfonia?", a: ["Mozart", "Bach", "Beethoven", "Haydn"], c: 2 },
            { q: "Quin comp√†s t√© 3 temps?", a: ["2/4", "3/4", "4/4", "6/8"], c: 1 },
            { q: "Qu√® √©s un puntet?", a: ["Afegeix meitat del valor", "Duplica el valor", "Resta valor", "Silenci"], c: 0 },
            { q: "Quina nota val 0.5 temps?", a: ["Negra", "Corxera", "Semicorxera", "Fusa"], c: 1 },
            { q: "Qu√® √©s un metr√≤nom?", a: ["Instrument", "Mesurador de temps", "Tipus de ball", "Compositor"], c: 1 },
            { q: "Quina figura √©s m√©s r√†pida?", a: ["Negra", "Corxera", "Semicorxera", "Fusa"], c: 3 },
            { q: "Quants temps dura una Blanca amb punt?", a: ["2", "2.5", "3", "4"], c: 2 },
            { q: "Qui √©s el pare de la simfonia?", a: ["Haydn", "Mozart", "Beethoven", "Schubert"], c: 0 },
            { q: "Quina √©s la nota m√©s llarga?", a: ["Rodona", "Blanca", "Negra", "Corxera"], c: 0 }
        ];

        const PRIZES = [
            "100‚Ç¨", "200‚Ç¨", "300‚Ç¨", "500‚Ç¨", "1.000‚Ç¨",
            "2.000‚Ç¨", "4.000‚Ç¨", "8.000‚Ç¨", "16.000‚Ç¨", "32.000‚Ç¨",
            "64.000‚Ç¨", "125.000‚Ç¨", "250.000‚Ç¨", "500.000‚Ç¨", "1.000.000‚Ç¨"
        ];

        class Game {
            constructor() {
                this.level = 0;
                this.used50 = false;
                this.usedPhone = false;
                this.usedPublic = false;
                this.waiting = false;
            }

            start() {
                document.getElementById('instructions-modal').style.display = 'none';
                this.renderLadder();
                this.loadQuestion();
            }

            renderLadder() {
                const el = document.getElementById('ladder');
                el.innerHTML = '';
                PRIZES.forEach((p, i) => {
                    const div = document.createElement('div');
                    div.className = 'ladder-step';
                    if (i === 4 || i === 9 || i === 14) div.classList.add('safe');
                    div.textContent = (i + 1) + " - " + p;
                    div.id = 'step-' + i;
                    el.appendChild(div);
                });
            }

            loadQuestion() {
                if (this.level >= QUESTIONS.length) {
                    this.win();
                    return;
                }

                // Highlight ladder
                for (let i = 0; i < PRIZES.length; i++) {
                    document.getElementById('step-' + i).classList.remove('active');
                }
                document.getElementById('step-' + this.level).classList.add('active');

                const q = QUESTIONS[this.level];
                document.getElementById('question-box').textContent = q.q;

                for (let i = 0; i < 4; i++) {
                    const btn = document.getElementById('btn-' + i);
                    btn.textContent = ["A: ", "B: ", "C: ", "D: "][i] + q.a[i];
                    btn.style.visibility = 'visible';
                    btn.classList.remove('correct', 'wrong');
                    btn.disabled = false;
                }
                this.waiting = false;
            }

            answer(idx) {
                if (this.waiting) return;
                this.waiting = true;

                const q = QUESTIONS[this.level];
                const btn = document.getElementById('btn-' + idx);

                if (idx === q.c) {
                    // Correct
                    btn.classList.add('correct');
                    playSound('correct');
                    setTimeout(() => {
                        this.level++;
                        this.loadQuestion();
                    }, 2000);
                } else {
                    // Wrong
                    btn.classList.add('wrong');
                    document.getElementById('btn-' + q.c).classList.add('correct'); // Show correct
                    playSound('wrong');
                    setTimeout(() => {
                        document.getElementById('lose-modal').style.display = 'flex';
                    }, 2000);
                }
            }

            use5050() {
                if (this.used50 || this.waiting) return;
                this.used50 = true;
                document.getElementById('life-50').classList.add('used');

                const q = QUESTIONS[this.level];
                let removed = 0;
                for (let i = 0; i < 4; i++) {
                    if (i !== q.c && removed < 2) {
                        document.getElementById('btn-' + i).style.visibility = 'hidden';
                        removed++;
                    }
                }
            }

            usePhone() {
                if (this.usedPhone || this.waiting) return;
                this.usedPhone = true;
                document.getElementById('life-phone').classList.add('used');

                const q = QUESTIONS[this.level];
                const composers = ["Mozart", "Beethoven", "Bach", "Haydn"];
                const comp = composers[Math.floor(Math.random() * composers.length)];

                // 80% chance correct
                let ans = q.a[q.c];
                if (Math.random() > 0.8) {
                    // Wrong answer
                    const wrong = q.a.find((_, i) => i !== q.c);
                    ans = wrong;
                }

                document.getElementById('phone-msg').textContent = `${comp} diu: "Crec que la resposta √©s... ${ans}!"`;
                document.getElementById('phone-modal').style.display = 'flex';
            }

            usePublic() {
                if (this.usedPublic || this.waiting) return;
                this.usedPublic = true;
                document.getElementById('life-public').classList.add('used');

                const q = QUESTIONS[this.level];
                // Simulate percentages
                let p = [0, 0, 0, 0];
                p[q.c] = 60 + Math.floor(Math.random() * 20); // 60-80%
                let rem = 100 - p[q.c];
                for (let i = 0; i < 4; i++) {
                    if (i !== q.c) {
                        let share = Math.floor(Math.random() * rem);
                        p[i] = share;
                        rem -= share;
                    }
                }
                // Add remaining to last wrong
                p.find((v, i) => i !== q.c && v === 0) ? p[p.findIndex((v, i) => i !== q.c && v === 0)] += rem : p[q.c] += rem;

                let msg = "P√∫blic:\n";
                ["A", "B", "C", "D"].forEach((l, i) => {
                    msg += `${l}: ${p[i]}%\n`;
                });
                alert(msg); // Simple alert for public
            }

            win() {
                const rewards = JSON.parse(sessionStorage.getItem('casinoRewards') || '{}');
                rewards['reward_millonario'] = true;
                sessionStorage.setItem('casinoRewards', JSON.stringify(rewards));
                playSound('correct');
                document.getElementById('epic-modal').style.display = 'flex';
            }
        }

        const game = new Game();
    </script>
</body>

</html>